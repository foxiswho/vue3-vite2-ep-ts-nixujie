{"version":3,"file":"login.253e0555.js","sources":["../../src/utils/formExtend.ts","../../src/views/login/login.vue"],"sourcesContent":["import { Ref, unref } from 'vue'\n\n/**\n * 表单校验\n * @param ref 节点\n * @param isGetError 是否获取错误项\n */\nexport async function validate(ref: Ref|any, isGetError = false):Promise<boolean | {valid: boolean, object: any}> {\n    const validateFn = unref(ref).validate\n    return new Promise(resolve => validateFn((valid:boolean, object: any) => isGetError ? resolve({ valid, object }) : resolve(valid)))\n}\n\n/**\n * 对部分表单字段进行校验的方法\n * @param ref 节点\n * @param props 字段属性\n */\nexport async function validateField(ref: Ref|any, props: Array<string> | string):Promise<string> {\n    const validateFieldFn = unref(ref).validateField\n    return new Promise(resolve => validateFieldFn(props, (errorMessage: string) => resolve(errorMessage)))\n}\n\n/**\n * 重置表单\n * @param ref 节点\n */\nexport function resetFields(ref: Ref|any):void {\n    const resetFieldsFn = unref(ref).resetFields\n    resetFieldsFn()\n}\n\n/**\n * 移除表单项的校验结果\n * @param ref 节点\n * @param props 字段属性\n */\nexport function clearValidate(ref: Ref|any, props?: Array<string> | string):void {\n    const clearValidateFn = unref(ref).clearValidate\n    props ? clearValidateFn(props) : clearValidateFn()\n}","<template>\n  <div\n    class='layout-login'\n    @keyup='enterSubmit'\n  >\n    <el-form\n      ref='ruleForm'\n      label-position='right'\n      label-width='80px'\n      :model='form'\n      :rules='rules'\n    >\n      <el-form-item\n        label='用户名'\n        prop='name'\n      >\n        <el-input v-model='form.name'/>\n      </el-form-item>\n      <el-form-item\n        label='密码'\n        prop='pwd'\n      >\n        <el-input\n          v-model='form.pwd'\n          type='password'\n          autocomplete='off'\n        />\n      </el-form-item>\n      <el-form-item>\n        <el-button\n          type='primary'\n          @click='onSubmit'\n        >\n          登录\n        </el-button>\n        <el-button @click='resetFields(ruleForm)'>\n          重置\n        </el-button>\n      </el-form-item>\n      <el-form-item>\n        <p class='leading-5'>\n          账号: admin 密码: admin\n        </p>\n        <p class='leading-5'>\n          账号: dev 密码: dev\n        </p>\n        <p class='leading-5'>\n          账号: test 密码: test\n        </p>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {defineComponent, reactive, ref} from 'vue'\nimport {ElNotification} from 'element-plus'\nimport {validate, resetFields} from '@/utils/formExtend'\nimport {useStore} from 'vuex'\nimport {useRouter, useRoute} from \"vue-router\";\n\nexport default defineComponent({\n  name: 'Login',\n  setup() {\n    let form = reactive({\n      name: 'admin',\n      pwd: 'admin'\n    })\n    const ruleForm = ref(null)\n    const enterSubmit = (e: KeyboardEvent) => {\n      if (e.key === 'Enter') {\n        onSubmit()\n      }\n    }\n\n    function getOtherQuery(query:any) {\n      return Object.keys(query).reduce((acc:any, cur:string) => {\n        if (cur !== 'redirect') {\n          acc[cur] = query[cur]\n        }\n        return acc\n      }, {})\n    }\n\n    const router = useRouter();\n    const route = useRoute();\n    const store = useStore()\n    const redirect = route.query && route.query.redirect ? route.query.redirect : ''\n    const otherQuery = route.query ? getOtherQuery(route.query) : ''\n    // console.log(store.getters)\n    // console.log(redirect)\n    // console.log(otherQuery)\n    const onSubmit = async () => {\n      let {name, pwd} = form\n      if (!await validate(ruleForm)) return\n      await store.dispatch('layout/login', {username: name, password: pwd})\n        .then(() => {\n          ElNotification({\n            title: '欢迎',\n            message: '欢迎回来',\n            type: 'success'\n          })\n          //console.log(redirect)\n          //console.log(otherQuery)\n          router.push({path: redirect || '/', query: otherQuery})\n          // this.loading = false\n        })\n        .catch(() => {\n          // this.loading = false\n        })\n\n    }\n    const rules = reactive({\n      name: [\n        {\n          validator: (rule: any, value: any, callback: (arg0?: Error | undefined) => void) => {\n            if (!value) {\n              return callback(new Error('用户名不能为空'))\n            }\n            callback()\n          }, trigger: 'blur'\n        }\n      ],\n      pwd: [\n        {\n          validator: (rule: any, value: any, callback: (arg0?: Error | undefined) => void) => {\n            if (!value) {\n              return callback(new Error('密码不能为空'))\n            }\n            callback()\n          }, trigger: 'blur'\n        }\n      ]\n    })\n    return {\n      labelCol: {span: 4},\n      wrapperCol: {span: 14},\n      form,\n      onSubmit,\n      enterSubmit,\n      rules,\n      resetFields,\n      ruleForm\n    }\n  }\n})\n</script>\n\n<style scoped>\n.layout-login {\n  padding-top: 200px;\n  width: 400px;\n  margin: 0 auto;\n}\n</style>\n"],"names":["ref2","unref","resetFields","defineComponent","name","[object Object]","form","reactive","pwd","ruleForm","ref","router","useRouter","route","useRoute","store","useStore","redirect","query","otherQuery","Object","keys","reduce","acc","cur","onSubmit","async","isGetError","validateFn","validate","Promise","valid","object","resolve","dispatch","username","password","then","title","message","type","push","path","catch","rules","validator","rule","value","callback","Error","trigger","labelCol","span","wrapperCol","enterSubmit","e","key"],"mappings":"oMA0B4BA,MACFC,EAAMD,GAAKE,eCkCrC,MAAeC,EAAgB,CAC7BC,KAAM,QACNC,YACMC,EAAOC,EAAS,CAClBH,KAAM,QACNI,IAAK,gBAEDC,EAAWC,EAAI,YAgBfC,EAASC,IACTC,EAAQC,IACRC,EAAQC,IACRC,EAAWJ,EAAMK,OAASL,EAAMK,MAAMD,SAAWJ,EAAMK,MAAMD,SAAW,GACxEE,EAAaN,EAAMK,OAbFA,EAawBL,EAAMK,MAZ5CE,OAAOC,KAAKH,GAAOI,QAAO,CAACC,EAASC,KAC7B,aAARA,MACEA,GAAON,EAAMM,IAEZD,IACN,KAOyD,OAbvCL,QAiBjBO,EAAWC,cACXtB,KAACA,MAAMI,GAAOF,uBDtFON,EAAc2B,GAAa,SAChDC,EAAa3B,EAAMD,GAAK6B,gBACvB,IAAIC,YAAmBF,GAAW,CAACG,EAAeC,IAA6BC,EAAbN,EAAqB,CAAEI,MAAAA,EAAOC,OAAAA,GAAoBD,OCqF9GF,CAASpB,UACdM,EAAMmB,SAAS,eAAgB,CAACC,SAAU/B,EAAMgC,SAAU5B,IAC7D6B,MAAK,OACW,CACbC,MAAO,KACPC,QAAS,OACTC,KAAM,cAIDC,KAAK,CAACC,KAAMzB,GAAY,IAAKC,MAAOC,OAG5CwB,OAAM,UAKLC,EAAQrC,EAAS,CACrBH,KAAM,CACJ,CACEyC,UAAW,CAACC,EAAWC,EAAYC,SAC5BD,SACIC,EAAS,IAAIC,MAAM,iBAG3BC,QAAS,SAGhB1C,IAAK,CACH,CACEqC,UAAW,CAACC,EAAWC,EAAYC,SAC5BD,SACIC,EAAS,IAAIC,MAAM,gBAG3BC,QAAS,iBAIX,CACLC,SAAU,CAACC,KAAM,GACjBC,WAAY,CAACD,KAAM,IACnB9C,KAAAA,EACAmB,SAAAA,EACA6B,YAtEmBC,IACL,UAAVA,EAAEC,UAsENZ,MAAAA,EACA1C,YAAAA,EACAO,SAAAA"}